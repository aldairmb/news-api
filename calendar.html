<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Range, Category, and Sort Filter</title>
    <!-- Include Flatpickr CSS from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <h1>Select Date Range, Category, and Sort Order</h1>

    <!-- Category Dropdown -->
    <label for="category">Select Category:</label>
    <select id="category">
        <option value="">Select Category</option>
        <option value="business">Business</option>
        <option value="entertainment">Entertainment</option>
        <option value="general">General</option>
        <option value="health">Health</option>
        <option value="science">Science</option>
        <option value="sports">Sports</option>
        <option value="technology">Technology</option>
    </select>
    
    <!-- Sort Order Dropdown -->
    <label for="sortOrder">Sort by:</label>
    <select id="sortOrder">
        <option value="relevancy">Relevancy</option>
        <option value="popularity">Popularity</option>
        <option value="publishedAt">Published Date</option>
    </select>

    <!-- Date Range Picker -->
    <input type="text" id="dateRangePicker" placeholder="Select Date Range">

    <button id="filter">Filter Articles</button>

    <h2>Headlines:</h2>
    <ul id="article-list"></ul>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Initialize Flatpickr with range mode
        flatpickr("#dateRangePicker", {
            mode: "range",
            dateFormat: "Y-m-d",  // Format the date (Year-Month-Day)
            onChange: function(selectedDates) {
                console.log("Selected Dates:", selectedDates);  // Log the selected date range
            }
        });

        // Handle button click to fetch the selected date range, category, sort order, and display articles
        document.getElementById('filter').addEventListener('click', () => {
            const selectedDates = document.querySelector('#dateRangePicker')._flatpickr.selectedDates;
            const category = document.querySelector('#category').value;
            const sortOrder = document.querySelector('#sortOrder').value;
            console.log("Clicked Filter Button, Selected Dates:", selectedDates);  // Debug log

            if (selectedDates.length === 2 && category && sortOrder) {
                const startDate = selectedDates[0].toISOString().split('T')[0];  // Format to YYYY-MM-DD
                const endDate = selectedDates[1].toISOString().split('T')[0];    // Format to YYYY-MM-DD

                console.log(`Making API request from ${startDate} to ${endDate} in category ${category} with sort order ${sortOrder}`);  // Log the date range, category, and sort order being used

                // Make API request to News API with the selected filters
                fetch(`https://newsapi.org/v2/everything?q=${category}&from=${startDate}&to=${endDate}&pageSize=5&sortBy=${sortOrder}&apiKey=b9b25782075944c282a534210d4027eb`)
                    .then(response => {
                        console.log("API Response Status:", response.status);  // Check the response status
                        if (!response.ok) {
                            throw new Error('API request failed');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("API Response Data:", data);  // Log the full API response

                        const articles = data.articles;
                        if (articles && articles.length > 0) {
                            const articleList = document.getElementById("article-list");

                            // Clear any existing articles
                            articleList.innerHTML = '';

                            // Loop through the articles and display their headlines, sources, and dates
                            articles.forEach(article => {
                                const listItem = document.createElement("li");
                                
                                // Format the date to a more readable format (e.g., "Dec 15, 2024")
                                const articleDate = new Date(article.publishedAt).toLocaleDateString("en-US", {
                                    weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'
                                });

                                // Create a list item with headline, source, and date
                                listItem.innerHTML = `
                                    <strong>${article.title}</strong><br>
                                    <em>Source: ${article.source.name}</em><br>
                                    <em>Published on: ${articleDate}</em>
                                `;

                                articleList.appendChild(listItem);
                            });
                        } else {
                            alert('No articles found for the selected filters');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching articles:', error);
                        alert('Error fetching articles, please try again later.');
                    });
            } else {
                alert('Please select both start and end dates, a category, and a sort order');
            }
        });
    </script>
</body>
</html>
